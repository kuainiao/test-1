<?php/** * Created by JetBrains PhpStorm. * User: yang * Date: 13-8-3 * Time: 下午1:00 * To change this template use File | Settings | File Templates. */require_once "../../halo/HaloLog.php";require_once "../../models/PayFailureModel.php";class ConnectGameServer{    public function payToGameServer($serverName, $thirdType, $merUsername, $accountId, $gameMoney, $orderId)    {        if ($serverName == 101)        {            $host = '103.26.0.95';        }        elseif ($serverName == 102)        {            $host = '103.26.0.95';        }elseif ($serverName == 103)		{			$host = '103.26.0.95';		}        else        {            $host = $this->getHost($serverName);        }		        $port = 12589;        $packLength = 192;        $msgCrc = 1623520129;        $msgLength = 156;        $goldCode = 96549875;        $rewardNumber = 0;        $rewardType = 0;        $receiveType = 0;        $type = 1;        $timeout = 10;        $area = $serverName;				if($serverName==20001){			$packLength = 192;			$msgLength  = 156;	    }        switch ($serverName)        {			case '20001':				$serverName = '光芒之城';//热血问战测试服                break;            case '201':                $serverName = '道祖';                break;            case '202':                $serverName = '天下';                break;			case '210':                $serverName = '屠龙';                break;            case '204':                $serverName = '诛仙';                break;            case '205':                $serverName = '涌泉';                break;            case '211':                $serverName = '御天';                break;			case '207':                $serverName = '通天';                break;			case '209':                $serverName = '战国';                break;			case '301':				$serverName = '地狱之炎';                break;			case '302':				$serverName = '热血传奇';                break;            case '303':                $serverName = '魔族入侵';                break;            case '304':                $serverName = '笑傲武林';                break;			case '305':				$serverName = '指点江山';                break;            case '310':				$serverName = '战神之怒';                break;			case '311':				$serverName = '千年沙城';                break;            case '1001':                $serverName = '风沙暗';                break;            case '1002':                $serverName = '问天道';                break;            case '1003':                $serverName = '胡雁鸣';                break;			case '1004':                $serverName = '醉江湖';                break;            case '2001':                $serverName = '王者之夜';//问战神的测试服                break;            case '100001':                $serverName = '沃玛';//问战云顶服                break;			case '100002':                $serverName = '虎卫';//问战云顶服				break;			case '100003':                $serverName = '雷炎';//问战云顶服				break;			case '100004':                $serverName = '虎跃';//问战云顶服				break;			case '100005':                $serverName = '卧虎';//问战云顶服				break;			case '100006':                $serverName = '藏龙';//问战云顶服				break;			case '100007':                $serverName = '兄弟';//问战云顶服				break;			case '100008':                $serverName = '武易';//问战云顶服				break;			case '100009':                $serverName = '龙回';//问战云顶服				break;			case '100010':                $serverName = '独尊';//问战云顶服				break;			case '100011':                $serverName = '血饮';//问战云顶服				break;			case '100012':                $serverName = '龙纹';//问战云顶服				break;			case '100013':                $serverName = '龙武';//问战云顶服				break;			case '100014':                $serverName = '魔侠';//问战云顶服				break;			case '100015':                $serverName = '主宰';//问战云顶服				break;			case '100016':                $serverName = '朱雀';//问战云顶服				break;			case '100017':                $serverName = '麒麟';//问战云顶服				break;			case '100018':                $serverName = '巨象';//问战云顶服				break;			case '100019':                $serverName = '荣耀';//问战云顶服				break;			case '100020':                $serverName = '猛将';//问战云顶服				break;			case '100021':                $serverName = '怒火';//问战云顶四区服				break;			case '100022':                $serverName = '战刃';//问战云顶四区服				break;			case '100023':                $serverName = '震天';//问战云顶四区服				break;			case '100024':                $serverName = '雪妖';//问战云顶四区服				break;			case '100025':                $serverName = '雄才';//问战云顶四区服				break;			case '100026':                $serverName = '终极';//问战云顶四区服				break;			case '100027':                $serverName = '神域';//问战云顶四区服				break;			case '100028':                $serverName = '迷失';//问战云顶四区服				break;			case '200007':                $serverName = '征战九州';//铁血九州测试服				break;			case '500001':                $serverName = '热血烈火';//热血烈火测试服				break;			case '200001':                $serverName = '铁血';//铁血九州				break;			case '200002':                $serverName = '九州';//铁血九州				break;			case '200003':                $serverName = '天祈';//铁血九州				break;            case '300001':                $serverName = '战八方';//应用宝                break;			case '300002':                $serverName = '战沙场';//应用宝                break;			case '300003':                $serverName = '玉门关';//应用宝                break;			case '300004':                $serverName = '望烽火';//应用宝                break;			case '300005':                $serverName = '狼烟起';//应用宝                break;			case '300006':                $serverName = '追骄虏';//应用宝                break;			case '10001':                $serverName = '边关之战';//边荒测试服                break;        }        $fp = stream_socket_client("$host:$port", $errno, $errstr, $timeout);        if (!$fp)        {            $errorString = $area."_".$thirdType."_".$orderId."_".$merUsername."_".$gameMoney."_"."payToGameServerError";            HaloLog::addLog('payToGameServer', $errorString);            $failTime = time();            $mark = 0;            $newPayFailure = new PayFailureModel();            $insertPayFailure = $newPayFailure->insertPayFailure($area, $thirdType, $merUsername, $accountId, $gameMoney, $orderId, $failTime, $failTime, $mark);        }        else        {        	if($serverName=='光芒之城')            {        	$package = pack("VVVVa32a64a32a32VVVVV", $packLength, $msgCrc, $msgLength, $goldCode, $serverName, $orderId, $merUsername, $rewardNumber, $rewardType, $gameMoney, $accountId, $receiveType, $type);	        	}            else            {            $package = pack("VVVVa32a64a32a32VVVVV", $packLength, $msgCrc, $msgLength, $goldCode, $serverName, $orderId, $merUsername, $rewardNumber, $rewardType, $gameMoney, $accountId, $receiveType, $type);			}            fwrite($fp, $package);            while (!feof($fp))            {                echo fgets($fp, 4096);            }        }        fclose($fp);    }		//通过区服获取充值host	public function getHost($server){		if ($server >= 101 && $server < 200)        {            $host = '103.26.0.95';        }        elseif ($server >= 201 && $server < 300)        {            $host = '103.26.0.92';        }        elseif ($server >= 300 && $server < 400)        {            $host = '103.26.0.82';        }        elseif ($server >= 1000 && $server < 2000)        {            $host = '103.26.0.93';        }        elseif ($server >= 2000 && $server < 3000)        {            $host = '103.26.0.85';        }        elseif($server >=20000 && $server < 20100){        	$host = '103.26.0.16';        }        elseif($server >=100000 && $server < 101000){            $host = '103.26.0.94';        }        elseif($server >=200000 && $server < 201000){            $host = '103.26.0.89';        }        elseif($server >=300000 && $server < 301000){            $host = '103.26.0.90';        }		elseif($server >=400000 && $server < 401000){            $host = '103.26.0.31';        }		elseif($server >=500000 && $server < 501000){            $host = '103.26.0.83';        }		elseif($server >=10000 && $server < 20000){            $host = '103.26.0.76';        }        else{        	return false;        }		return $host;	}}